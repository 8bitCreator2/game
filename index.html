<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stardust</title>
  <style>
    :root {
      --bg: #121212;
      --panel: #1b1b1b;
      --line: #353535;
      --text: #d7ffd7;
      --muted: #9bb49b;
      --accent: #e2ffe2;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: radial-gradient(circle at center, #3a3a3a 0%, #232323 42%, var(--bg) 100%);
      color: var(--text);
      font-family: "Press Start 2P", "VT323", "IBM Plex Mono", monospace;
      padding: 1rem;
    }

    .app {
      width: min(920px, 97vw);
      border: 1px solid var(--line);
      background: var(--panel);
      padding: 1rem;
      box-shadow: 0 0 24px rgba(110, 190, 110, 0.15);
    }

    h1 {
      margin: 0 0 0.8rem;
      font-size: 1.05rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.07em;
    }

    .grid,
    .upgrades {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(215px, 1fr));
      gap: 0.6rem;
      margin-bottom: 0.7rem;
    }

    .card {
      border: 1px solid var(--line);
      background: #181818;
      padding: 0.65rem;
      box-shadow: inset 0 0 10px rgba(180, 220, 180, 0.07);
    }

    .label,
    .upgrade-title {
      color: var(--muted);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.25rem;
    }

    .value {
      font-size: 1.02rem;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
    }

    .muted {
      color: var(--muted);
      font-size: 0.74rem;
      line-height: 1.4;
      margin: 0.15rem 0;
    }

    button {
      margin-top: 0.45rem;
      width: 100%;
      border: 1px solid #4f664f;
      background: #121212;
      color: var(--accent);
      padding: 0.5rem;
      font-family: inherit;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 0.7rem;
      cursor: pointer;
    }

    button:hover:not(:disabled) {
      border-color: #bcdfbc;
      color: #fff;
    }

    button:disabled {
      cursor: not-allowed;
      color: #678067;
      border-color: #2e3a2e;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background: repeating-linear-gradient(
        to bottom,
        rgba(0, 0, 0, 0.11) 0,
        rgba(0, 0, 0, 0.11) 2px,
        transparent 2px,
        transparent 4px
      );
      opacity: 0.33;
    }
  </style>
</head>
<body>
  <main class="app">
    <h1>Stardust Incremental</h1>

    <section class="grid">
      <article class="card">
        <div class="label">Current Stardust</div>
        <div class="value" id="stardust">0</div>
      </article>

      <article class="card">
        <div class="label">Generation / second</div>
        <div class="value" id="gps">1</div>
      </article>

      <article class="card">
        <div class="label">Stardust Rank</div>
        <div class="value" id="rank">0</div>
        <p class="muted" id="rankReq"></p>
        <button id="rankUp">Rank up</button>
      </article>

      <article class="card">
        <div class="label">Current Boosts</div>
        <div class="muted" id="boosts"></div>
      </article>
    </section>

    <section class="upgrades">
      <article class="card">
        <div class="upgrade-title">Upgrade 1 · Dust Scoop</div>
        <p class="muted">+1 base generation each level.</p>
        <p class="muted" id="u1"></p>
        <button id="buy1">Buy</button>
      </article>

      <article class="card">
        <div class="upgrade-title">Upgrade 2 · Amplifier</div>
        <p class="muted">Increases generation by current % (diminishing stack).</p>
        <p class="muted" id="u2"></p>
        <button id="buy2">Buy</button>
      </article>

      <article class="card">
        <div class="upgrade-title">Upgrade 3 · Calibration</div>
        <p class="muted">Increases Upgrade 2 base by +8% each level.</p>
        <p class="muted" id="u3"></p>
        <button id="buy3">Buy</button>
      </article>

      <article class="card">
        <div class="upgrade-title">Upgrade 4 · Stabilizer</div>
        <p class="muted">+35% additive boost to Upgrade 2 base each level.</p>
        <p class="muted" id="u4"></p>
        <button id="buy4">Buy</button>
      </article>

      <article class="card" id="u5Card" hidden>
        <div class="upgrade-title">Upgrade 5 · Compression</div>
        <p class="muted">Reduces upgrade costs (except itself).</p>
        <p class="muted" id="u5"></p>
        <button id="buy5">Buy</button>
      </article>
    </section>
  </main>

  <script>
    const game = {
      stardust: 0,
      rank: 0,
      upgrades: [0, 0, 0, 0, 0],
      baseCosts: [12, 36, 92, 180, 950]
    };

    const format = (n, digits = 2) => n.toLocaleString(undefined, { maximumFractionDigits: digits });

    const rankUnlocked = () => game.upgrades[3] >= 5;
    const rankRequirementU4Level = () => 5 + game.rank * 2;
    const rank1BoostMultiplier = () => 1 + game.rank * 0.10;
    const upgrade5Unlocked = () => game.rank >= 3;

    const costReducer = () => {
      if (!upgrade5Unlocked()) return 1;
      const reduceBy = Math.min(0.75, game.upgrades[4] * 0.08);
      return 1 - reduceBy;
    };

    const upgradeCost = (index) => {
      const growth = [1.4, 1.95, 2.1, 2.25, 2.45][index];
      const base = game.baseCosts[index] * Math.pow(growth, game.upgrades[index]);
      if (index === 4) return Math.floor(base);
      return Math.floor(base * costReducer());
    };

    const upgrade2BasePercentRaw = () => {
      const base = 20;
      const calibrationBoost = 1 + game.upgrades[2] * 0.08;
      const stabilizerBoost = 1 + game.upgrades[3] * 0.35;
      return base * calibrationBoost * stabilizerBoost;
    };

    const dampenPercent = (rawPercent) => {
      if (rawPercent <= 70) return rawPercent;
      if (rawPercent <= 220) return 70 + Math.pow(rawPercent - 70, 0.5) * 5;
      return 70 + Math.pow(150, 0.5) * 5 + Math.log10(rawPercent - 219) * 8;
    };

    const weightedU2Levels = (levels) => {
      let total = 0;
      for (let i = 0; i < levels; i += 1) {
        total += 1 / (1 + i * 0.12);
      }
      return total;
    };

    const generationPerSecond = () => {
      const baseGen = (1 + game.upgrades[0]) * rank1BoostMultiplier();
      const u2PercentEach = dampenPercent(upgrade2BasePercentRaw());
      const u2LevelsWeighted = weightedU2Levels(game.upgrades[1]);
      const u2Multiplier = Math.pow(1 + u2PercentEach / 100, u2LevelsWeighted);
      return baseGen * u2Multiplier;
    };

    function buyUpgrade(index) {
      const cardLocked = index === 4 && !upgrade5Unlocked();
      if (cardLocked) return;

      const cost = upgradeCost(index);
      if (game.stardust < cost) return;
      game.stardust -= cost;
      game.upgrades[index] += 1;
      render();
    }

    function rankUp() {
      if (!rankUnlocked()) return;
      const req = rankRequirementU4Level();
      if (game.upgrades[3] < req) return;

      game.rank += 1;
      game.stardust = 0;
      game.upgrades = [0, 0, 0, 0, 0];
      render();
    }

    function render() {
      const gps = generationPerSecond();
      const raw = upgrade2BasePercentRaw();
      const eff = dampenPercent(raw);
      const weighted = weightedU2Levels(game.upgrades[1]);

      document.getElementById('stardust').textContent = format(game.stardust);
      document.getElementById('gps').textContent = format(gps, 3);
      document.getElementById('rank').textContent = game.rank;

      const rankButton = document.getElementById('rankUp');
      const rankReqText = document.getElementById('rankReq');
      const req = rankRequirementU4Level();
      if (!rankUnlocked()) {
        rankReqText.textContent = 'Unlock at Upgrade 4 level 5.';
        rankButton.disabled = true;
      } else {
        rankReqText.textContent = `Requirement: Upgrade 4 level ${req} (+2 each rank). Rank resets all upgrades.`;
        rankButton.disabled = game.upgrades[3] < req;
      }

      document.getElementById('u5Card').hidden = !upgrade5Unlocked();

      document.getElementById('boosts').innerHTML = [
        `u1 rank boost: <b>x${format(rank1BoostMultiplier())}</b>`,
        `cost reduction: <b>${format((1 - costReducer()) * 100)}%</b>`,
        `rank reset: <b>active</b> on every rank up`
      ].join('<br>');

      const labels = [
        `lvl ${game.upgrades[0]} · base ${(1 + game.upgrades[0]).toFixed(0)}/s · next ${upgradeCost(0)} stardust`,
        `lvl ${game.upgrades[1]} · base ${format(raw)}% · effective ${format(eff)}% · weighted ${format(weighted, 2)} · next ${upgradeCost(1)}`,
        `lvl ${game.upgrades[2]} · boosts u2 base by ${format(game.upgrades[2] * 8)}% · next ${upgradeCost(2)} stardust`,
        `lvl ${game.upgrades[3]} · boosts u2 base by ${format(game.upgrades[3] * 35)}% · next ${upgradeCost(3)} stardust`,
        `lvl ${game.upgrades[4]} · cost reduction ${format((1 - costReducer()) * 100)}% · next ${upgradeCost(4)} stardust`
      ];

      ['u1', 'u2', 'u3', 'u4', 'u5'].forEach((id, i) => {
        const labelEl = document.getElementById(id);
        if (!labelEl) return;
        labelEl.textContent = labels[i];
      });

      [1, 2, 3, 4, 5].forEach((n, i) => {
        const btn = document.getElementById(`buy${n}`);
        if (!btn) return;
        if (i === 4 && !upgrade5Unlocked()) {
          btn.disabled = true;
          return;
        }
        btn.disabled = game.stardust < upgradeCost(i);
      });
    }

    document.getElementById('buy1').addEventListener('click', () => buyUpgrade(0));
    document.getElementById('buy2').addEventListener('click', () => buyUpgrade(1));
    document.getElementById('buy3').addEventListener('click', () => buyUpgrade(2));
    document.getElementById('buy4').addEventListener('click', () => buyUpgrade(3));
    document.getElementById('buy5').addEventListener('click', () => buyUpgrade(4));
    document.getElementById('rankUp').addEventListener('click', rankUp);

    setInterval(() => {
      game.stardust += generationPerSecond() / 20;
      render();
    }, 50);

    render();
  </script>
</body>
</html>
